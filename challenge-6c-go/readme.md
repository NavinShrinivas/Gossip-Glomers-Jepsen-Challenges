# Challenge #6c: Totally-Available, Read Committed Transactions

Now that you have data replicating between nodes from the [Totally-Available, Read Uncommitted Transactions challenge](https://fly.io/dist-sys/6b), weâ€™ll increase the difficulty by strengthening our consistency model to [Read Committed](https://jepsen.io/consistency/models/read-committed).

Read Committed adds consistency guarantees while still being a relatively weak consistency model. In addition to G0, it also prohibits three additional anomalies:

-   _**G1a (aborted read):** An aborted transaction T1 writes key x, and a committed transaction T2 reads that write to x._
    
-   _**G1b (intermediate read):** A committed transaction T2 reads a value of key x that was generated by transaction T1 other than T1â€™s final write of x._
    
-   _**G1c (circular information flow):** A cycle of transactions linked by either write-read or read-write dependencies. For instance, transaction T1 writes x = 1 and reads y = 2, and transaction T2 writes y = 2 and reads x = 1_
    

In summary, these ensure that changes made during a transaction are not visible to other transactions until they are committed.

## [](https://fly.io/dist-sys/6c//#specification)Specification

Ensure your distributed key/value store implements a Read Committed consistency model while also preserving total availability.

### [](https://fly.io/dist-sys/6c//#aborting-transactions)Aborting transactions

To test G1a, you can abort a transaction by replying:

Unwrap text Copy to clipboard


<span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w">        </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"in_reply_to"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  
  </span><span class="nl">"code"</span><span class="p">:</span><span class="w">        </span><span class="mi">30</span><span class="p">,</span><span class="w">
  </span><span class="nl">"text"</span><span class="p">:</span><span class="w">        </span><span class="s2">"The requested transaction has been aborted because of a conflict with another transaction. Servers need not return this error on every conflict: they may choose to retry automatically instead."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span>


The Maelstrom code of `30` is `txn-conflict`. The `in_reply_to` should be the message ID of the request to be aborted.

This can be done with the Go client with:

Unwrap text Copy to clipboard


<span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">Reply</span><span class="p">(</span>
    <span class="n">msg</span><span class="p">,</span>
    <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="n">any</span><span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"error"</span><span class="p">,</span>
        <span class="s">"code"</span><span class="o">:</span> <span class="n">maelstrom</span><span class="o">.</span><span class="n">TxnConflict</span><span class="p">,</span>
        <span class="s">"text"</span><span class="o">:</span> <span class="s">"txn abort"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>


## [](https://fly.io/dist-sys/6c//#evaluation)Evaluation

Build your Go binary as `maelstrom-txn` and run it against Maelstrom with the following command:

Unwrap text Copy to clipboard


./maelstrom test -w txn-rw-register --bin ~/go/bin/maelstrom-txn --node-count 2 --concurrency 2n --time-limit 20 --rate 1000 --consistency-models read-committed --availability total â€“-nemesis partition


If youâ€™re successful, thatâ€™s amazing! Youâ€™ve made it to the end of the Fly.io Distributed Systems Challenge. ðŸŽ‰ðŸŽ‰ðŸŽ‰

If youâ€™re having trouble, jump over to the [Fly.io Community forum](https://community.fly.io/) for help.

If youâ€™ve helped others working on these challenges in the Community forum, we offer our sincere thanks. These are hard topics to wrap our brains around and we all need a hand from time to time.
